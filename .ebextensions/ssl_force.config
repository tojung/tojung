files:
  "/etc/httpd/conf.d/00_ssl_rewrite.conf":
    mode: "000644"
    owner: root
    group: root
    content: |
      <VirtualHost *:80>
        <Proxy *>
          Order deny,allow
          Allow from all
        </Proxy>

        ProxyPass / http://localhost:8080/ retry=0
        ProxyPassReverse / http://localhost:8080/
        ProxyPreserveHost on

        ErrorLog /var/log/httpd/elasticbeanstalk-error_log

        RewriteEngine on
        RewriteCond %{HTTP:X-Forwarded-Proto} =http
        RewriteRule ^ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

      </VirtualHost>

services:
  sysvinit:
    httpd:
      files:
        - "/etc/httpd/conf.d/00_ssl_rewrite.conf"